2_Technical_BigData

<p align="center">
<img src="https://user-images.githubusercontent.com/40620421/183598835-ebf8d4ba-354d-4b02-8ccd-a7d1f2d29018.jpg" width="300">

본 내용은 해당 도서를 참고하여 정리한 내용입니다.
</p>

<br/>
<br/>
<br/>

# 2. 빅데이터의 탐색

## 2-1. 크로스 집계의 기본
- 데이터 시각화에서 먼저 기본이 되는 것이 크로스 집계
- `크로스 집계`: 트랜잭션 테이블에서 크로스 테이블로 변환하는 과정
    1. 크로스 테이블: 행과 열이 교차하는 부분에 숫자 데이터가 들어가는 테이블
    1. 트랜잭션 테이블: 행을 기준으로 데이터가 추가되는 테이블

<img src="https://user-images.githubusercontent.com/40620421/185924635-c1f3f12d-b655-49ee-9382-6ba4b359acf0.png" width="500">

### SQL에 의한 테이블 집계
- 대량의 데이터를 크로스 집계하기 위해 SQL을 활용
    - 데이터 양이 너무 많으면 피벗 테이블을 통한 크로스 집계가 어려움
- SQL을 통해서 크로스 테이블이 아닌 트랜잭션 테이블의 형태로 얻고, 이를 크로스 집계함으로써 임의의 크로스 테이블을 얻을 수 있음
```sql
SELECT 매출일, 점포 ID, 금액 FROM 판매이력
```
매출일|점포ID|고객ID|금액
--|--|--|--
2022-08-01|1|10|60000
2022-08-01|1|11|50000
2022-08-01|2|12|30000
2022-08-02|1|13|120000
2022-08-02|2|14|50000
2022-08-02|2|15|40000

점포ID\매출일|2022-08-01|2022-08-02
--|--|--
1|110000|120000
2|30000|90000

- 데이터 집계를 `SQL`로 하고, 크로스 집계를 `시각화 도구`로 함으로써 이론상 무한히 많은 데이터가 있더라도 크로스 집계가 가능하다
    - `데이터 집계의 프로세스`: SQL로 집계
    - `시각화 프로세스`: 시각화 도구로 크로스 집계

## 2-2. 열 지향 스토리지에 의한 고속화
대량의 데이터를 신속하게 집계하기 위한 DB 구조

### DB 지연 줄이기
- RDB는 메모리가 부족하면 급격히 성능이 저하된다
- `MPP 기술`
    - 고속화를 위해 사용되는 기법이 `압축과 분산`
    - 데이터를 최대한 압축한 후, 여러 디스크에 분산함으로써 데이터 로드의 지연을 줄인다
    - 멀티 코어를 활용하여 디스크 I/O를 병렬처리
    - 하드웨어 수준에서 균형된 CPU와 디스크를 가진 DB를 `MPP 데이터베이스`라고 함
    - Amazon RedShift, Google BigQuery

### 열 지향 DB 접근

#### 행 지향 DB
- 일반적으로 많이 사용되는 DB
- 데이터 검색을 위해서는 모든 레코드를 가져와야함 → 성능 저하
- `Index`를 통해 데이터 검색을 고속화
- 하지만 데이터 분석에서는 어떤 칼럼이 사용되는지 미리 알 수 없기 때문에 Index가 큰 도움이 되지 않음

#### Index
- 장점
    - 테이블을 조회하는 속도와 성능 향상
    - 시스템 부하를 줄임
- 단점
    - 인덱스를 관리하기 위한 추가 저장 공간 필요
    - 인덱스를 항상 정렬된 상태로 유지하기에 추가 작업이 필요
    - 인덱스를 잘못 사용할 경우 역효과가 날 수 있다.
- Index 권장 케이스
    - 데이터 양이 많은 테이블
    - 업데이트보다 조회가 잦은 테이블
    - 조건문이나 정렬이 잦은 테이블
- Index 자료 구조
    - Hash 인덱스 알고리즘, B-Tree 인덱스 알고리즘, B+Tree 인덱스 알고리즘 (균형 트리)

#### 열 지향 DB
- 데이터를 미리 `칼럼 단위`로 정리해 둠으로써 필요한 칼럼만 로드하여 디스크 I/O를 줄임
- 일부 칼럼만이 집계 대상이 될 때 유용함
- `압축 효율`이 우수함 (같은 칼럼에는 유사한 데이터가 나열되기 때문)
- `MPP`를 통해 하나의 쿼리를 다수의 작은 태스크로 분해하고 병렬로 실행
    - 디스크로부터 로드가 병목 현상이 발생하지 않도록 데이터가 고르게 분산되어 있어야함

## 2-3. 애드 혹 분석과 시각화 도구

### 대시보드 도구
- 새로운 그래프를 쉽게 추가할 수 있는 도구
- 최신의 집계 결과를 즉시 확인할 수 있길 기대
- 정해진 지표의 일상적인 변화를 모니터링

### BI 도구
- 대화형 데이터 탐색이 중요시됨
- ex. 몇개월 단위의 장기적인 데이터 추이를 시각화, 집계의 조건을 세부적으로 바꿈
- Tableau

## 2-4. 데이터 마트의 기본 구조
BI 도구에서 대화형으로 데이터를 참고하려면, 시각화 정보만을 모은 데이터 마트가 필수

### 시각화에 적합한 데이터 마트 만들기
- `OLAP`/online analytical processing
    - 사용자가 다차원 정보에 접근하여 대화식으로 정보를 분석하도록 지원
- `다차원 모델`
    - 데이터 집계를 효율화하는 접근 방법 중 하나
    - 데이터 분석을 위해 만들어진 다차원 데이터를 `OLAP 큐브`라고 하고, 그것을 크로스 집계하는 구조가 `OLAP`
    - 크로스 집계의 모든 조합을 미리 계산하여 DB안에 캐시해두고, 쿼리가 실행되면 집계된 결과를 반환하는 구조
    - 데이터 마트가 이전에 가지고 있던 구조
- `MPP DB와 비정규화 테이블`
    - MPP DB와 인 메모리 DB 등의 보급으로 사전에 계산할 필요가 없음
    - MPP DB에 다차원 모델의 개념이 없기 때문에 비정규화 테이블을 준비
    - 시각화에 적합한 데이터 마트를 만드는 것은 BI 도구를 윈한 `비정규화 테이블`을 만드는 프로세스

### 테이블을 비정규화하기

#### 정규화 테이블
- `트랜잭션`: 시간과 함께 생성되는 데이터
    - 시간과 함께 생성되기에 변하지 않음
- `마스터`: 트랜잭션에서 참고되는 각종 정보
    - 상황에 따라 일부 데이터가 업데이트됨
    - 고객 테이블에서 고객ID는 변경되지 않지만, 고객 주소와 같은 속성은 변경될 수 있음

#### 비정규화 테이블
- 과거
    - DW에서는 트랜잭션과 마스터를 `팩트 테이블`과 `디멘젼 테이블`이라고 칭함
    - DM를 만들 때 팩트 테이블을 중심으로 여러 디멘젼 테이블을 결합하는 것이 좋음 (`스타 스키마`)
- 현재
    - MPP DB와 열 지향 스토리지 시스템의 발달로 칼럼수가 아무리 늘어나도 성능에 영향을 주지 않는다
    - 처음부터 팩트 테이블에 모든 칼럼을 포함해두고, 쿼리 실행 시 테이블 결합을 하지 않는다
    - 장점
        1. 빠른 데이터 조회 (Join 비용이 줄어들기 때문)
        1. 데이터 조회 쿼리의 간단화
    - 단점
        1. 데이터 갱신이나 삽입 비용이 높음
        1. 데이터 무결성을 해침
        1. 데이터 중복 저장으로 인한 추가 저장공간 확보

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fk.kakaocdn.net%2Fdn%2FbJUNWP%2FbtqE2twgz5B%2FZ9qC1T74uCQ1CyAbKnUG60%2Fimg.png" width="500">


