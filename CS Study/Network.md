# 네트워크

## 기초
노드와 링크가 서로 연결되어 있거나 연결되어 있지 않은 집합체
- 노드: 서버, 라우터, 스위치
- 링크: 유선 또는 무선  

### 처리량과 지연 시간
'좋은' 네트워크? 처리량이 많음. 지연 시간이 짧음. 장애 빈도가 적음. 좋은 보안.   

- 처리량   
링크를 통해 전달되는 단위 시간당 데이터양 (bps, bits per second)   
처리량은 **트래픽**, **대역폭**, 네트워크 중간에 발생하는 에러, 하드웨어 스펙에 영향을 받음
    - **트래픽**  
    서버를 통해 최종 사용자에게 전달된 데이터의 양.  
    사용자가 많아질 수록 커진다.    
    트래픽 = 용량 * 사용자수 * 개수 = 4GB 영화 * 10명 * 10개 = 400GB
    - **대역폭**  
    주어진 시간동안 네트워크 연결을 통해 흐를 수 있는 **최대** 비트 수
    
- 지연 시간  
어떤 메시지가 두 노드를 왕복하는데 걸리는 시간. 요청이 처리되는 시간.  
이는 **매체 타입(무선, 유선)**, **패킷 크기**, **라우터의 패킷 처리 시간**에 영향을 받음

### 네트워크 토폴로지(Network topology)  
노드와 링크가 어떻게 배치되어 있는지에 대한 연결 형태.  
**병목 현상**을 찾는 데에 중요한 기준이 됨.
- 병목 현상  
전체 시스템의 성능이 하나의 구성 요소로 인해 제한을 받는 현상.  
네트워크 대역폭, 토폴로지, 서버 CPU/메모리에 영향을 받는다.


토폴로지 종류  
https://cozy-dandelion.tistory.com/39

<img src="https://media.istockphoto.com/vectors/network-topology-and-arrangement-of-telecommunication-structure-vector-id1221908141?s=612x612" width="300">

1. 트리 토폴로지  
개념: Tree구조 형태이다.  
장점: 통제 및 유지보수가 용이하다. 단말기 추가, 제거 및 에러 발생시 발견이 쉽다.  
단점: 병목 현상이 발생할 수 있다. 중앙 컴퓨터에 오류 발생 시 전체에 영향을 끼친다.

1. 버스 토폴로지  
개념: 중앙 통신 회선 하나에 여러 대의 노드를 연결. 근거리 통신망(LAN)에 사용.  
장점: 하나의 컴퓨터가 다운되어도 문제가 없다. 노드 추가/제거가 쉽다.  
단점: 통신 회선 길이에 제한이 있음. 충돌이 자주 일어난다. 스푸핑이 가능하다.

> 스푸핑: 송신부의 패킷을 송신과 관련 없는 다른 악의적인 노드에 전달되도록 처리하는 것

3. 스타형 토폴로지  
개념: 중앙에 있는 컴퓨터를 중심으로 터미널이 연결됨.  
장점: 유지보수 및 관리가 용이. 에러 탐지가 쉬움.  
단점: 중앙 컴퓨터 고장 시 전체 네트워크가 마비됨.

1. 링형 토폴로지  
개념: 인접해 있는 노드들을 연결하는 단방향 전송 형태.  
장점: 노드 수가 증가되어도 네트워크상 손실이 적음. 충돌이 발생되는 가능성이 적음.  
단점: 노드 추가/삭제가 어려움. 회선에 장애가 발생하면 전체에 영향.

1. 그물형 토폴로지  
개념: 모든 노드들이 상호 연결된 형태.  
장점: 회선에 장애가 발생해도 다른 경로로 통신이 가능.  
단점: 노드 추가/삭제가 어려움. 운영/구축 비용이 많이 듬.  
  
## TCP/IP 4계층 모델
- 네트워크에서 사용되는 **통신 프로토콜의 집합.**
- 호환성 보장 (다른 제조사 장비들끼리도 통신 가능), 각 계층에 대한 캡슐화와 은닉이 가능. 계층별로 문제 확인이 가능하여 쉽게 해결.
> 캡슐화, 은닉: 캡슐 내부 로직이나 변수들을 감추고 외부에는 기능만을 제공 
- TCP/IP 4계층 모델 또는 OSI 7계층 모델로 설명됨.
  
<img src="https://images.velog.io/images/jehjong/post/68e38b79-1117-4d48-b7c9-e04454205daa/image.png" width="400">  

차이점  
1. OSI에서는 Application 계층이 3개로 쪼개져 있음.
1. TCP/IP의 Internet 계층을 OSI에서는 Network 계층으로 불림.  

이 계층들은 서로 영향을 받지 않도록 설계됨.

### Application 계층
응용 프로그램이 사용되는 프로토콜 계층.  
웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공  

#### 예시
- FTP: 장치와 장치간의 **파일을 전송**하는데 사용되는 표준 통신 프로토콜.
- SMTP: **전자 메일 전송**을 위한 인터넷 표준 프로토콜.
- HTTP: WWW를 위한 데이터 통신의 기초. **웹사이트**를 이용하는데 쓰는 프로토콜.
- DNS: 도메인 이름과 IP 주소를 매필해주는 서버.
- SSH: 네트워크 상 다른 컴퓨터에 로그인하거나 원격 시스템에서 명령을 안전하게 실행하기 위한 암호화 네트워크 프로토콜.

### Transport 계층
송신자와 수신자를 연결하는 통신 서비스를 제공.  
Application 계층과 Internet 계층 사이에 데이터가 전달될 때 중계 역할을 함.

#### 예시
TCP  
- 패킷 사이의 순서를 보장하는 연결지향 프로토콜 사용. (높은 신뢰성을 가짐)  
- **가상회선 패킷 교환 방식**: 패킷에 가상회선 식별자가 포함. 패킷들은 전송된 순서대로 도착하는 방식.  
- 3-way handshake를 통한 연결 (신뢰성 확보)

<img src="https://s3.ap-south-1.amazonaws.com/afteracademy-server-uploads/what-is-a-tcp-3-way-handshake-process-three-way-handshaking-establishing-connection-6a724e77ba96e241.jpg" width="500">

1. SYN(Sychronization/요청) 단계  
클라이언트가 서버에 임의의 시퀀스 번호(ISN)을 보냄.
1. SYN+ACK(Acknowledgement/응답) 단계  
서버가 클라이언트의 SYN을 수신하고, 서버의 ISN + 클라이언트의 ISN+1 을 보냄.  
1. ACK 단계
클라이언트가 서버의 SYN을 수신하고, 서버의 ISN+1 을 보냄.

- 4-way handshake를 통한 연결 해제

<img src="https://velog.velcdn.com/images%2Faverycode%2Fpost%2F3ec34c06-3d54-45f3-a6fb-bc5bfb415001%2F%E1%84%80%E1%85%B5%E1%84%89%E1%85%AE%E1%86%AF%E1%84%86%E1%85%A7%E1%86%AB%E1%84%8C%E1%85%A5%E1%86%B8-6%202.jpg" width="500">

1. 클라이언트가 연결을 닫기 위해 서버로 FIN 플래그를 보내고, FIN_WAIT_1 상태로 응답을 기다린다.
1. 서버는 ACK라는 승인 플래그를 보낸다. 응답을 받은 클라이언트는 FIN_WAIT_2 상태가 된다.
1. 서버는 일정 시간 후 FIN 플래그를 보낸다.
1. 클라이언트는 FIN 플래그를 받고 TIME_WAIT 상태가 되며 서버로 ACK 플래그를 보내 서버는 CLOSED 상태가 된다.  
일정 시간 후 클라이언트는 CLOSED 상태가 되어 연결이 닫긴다.  
> TIME_WAIT가 있는 이유  
> 1. 지연 패킷이 발생하여 패킷을 처리하지 못 한다면 데이터 무결성 문제가 발생할 수 있다.
> 1. 서버의 연결이 닫혔는지 확인하기 위해서 (LAST_ACK 상태에서 멈춰 에러 발생할 수 있음)

UDP  
- 순서를 보장 X, 수신 여부를 확인 X, 단순히 데이터만 발신. (속도가 빠르다)  
- **데이터그램 패킷 교환 방식**: 패킷이 독립적으로 이동. 최적의 경로를 선택하여 이동.

### Internet 계층
- 상위 계층에서 받은 패킷을 IP 주소로 지정된 목적지로 전송하는 계층.  
- 호스트간의 라우팅 담당
- 상대방이 제대로 받았는지에 대해 보장하지 않는 비연결형적 특징을 가짐.

### Link 계층
- 전선, 광섬유, 무선 등 실질적으로 데이터를 전달하며 장치 간에 신호를 주고받는 규칙
    - 물리 계층: 무선 LAN과 유선 LAN을 통해 데이터를 보내는 계층
    - 데이터 링크 계층: 이더넷 프레임을 통해 에러 확인, 흐름 제어, 접근 제어를 담당하는 계층
- 물리적 주소로 MAC을 사용
    - MAC 주소: 컴퓨터나 노트북 등 각 장치에는 네트워크를 연결하기 위한 장치가 있는데, 이를 구별하기 위한 식별번호를 의미.

### 계층 간에 데이터 송수신

<img src="https://mblogthumb-phinf.pstatic.net/MjAxODAxMTNfMjIz/MDAxNTE1ODUzNzUzODM5.FP_zggvTRGjvViOWinAu-l6kO-VlWV66Cc9moHM5FKcg.HPx0n154P81GrDIkDmfElAS7patAF0tMlWIv2cLJzgUg.PNG.wnrjsxo/image.png?type=w800" width="600"> 

- 데이터가 다른 컴퓨터로 송신되기 위해 캡슐화를 거침.
- PDU(프로토콜 데이터 단위)  
각 계층을 거치며 헤더 정보가 추가되며 이름이 달라짐  
Data > Segment > IP Packet > Frame > bit  

## IP 주소
Internet 계층에서 IP 주소를 사용하여 데이터를 목적지로 전송한다.

### ARP (Address Resolution Protocol)
- IP 주소에서 ARP를 통해 MAC 주소를 찾아 MAC 주소를 기반으로 통신한다.
    - IP 주소(가상 주소) > **ARP** > MAC 주소(실제 주소)
    - MAC 주소(실제 주소) > **RARP** > IP 주소(가상 주소)

- 통신 과정에서 브로드캐스트를 통해서 IP 주소가 000.00.00.0인 장치를 찾고, 해당되는 장치가 'ARP reply 유니캐스트'를 통해 MAC 주소를 반환한다.
    - 브로드캐스트: 송신 호스트가 연결된 모든 호스트에 데이터를 전송하는 방식
    - 유니캐스트: 고유 주소로 식별된 하나의 네트워크 목적지에 1:1로 데이터를 전송하는 방식

 